name: update_golden_tests

on:
  workflow_dispatch:
    inputs:
      branch:
        description: "Branch to update golden tests for (defaults to workflow branch)"
        required: false
        type: string

permissions:
  contents: write

jobs:
  update-goldens:
    name: ğŸ–¼ï¸ Update Golden Test Files
    runs-on: ubuntu-latest
    timeout-minutes: 20
    steps:
      - name: ğŸ“š Git checkout
        uses: actions/checkout@v6.0.2
        with:
          ref: ${{ inputs.branch || github.ref_name }}
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: ğŸ¦ Setup Flutter
        uses: subosito/flutter-action@v2.21.0
        with:
          cache: true
          channel: "stable"

      - name: ğŸ“¦ Install dependencies
        working-directory: packages/world_flags
        run: flutter pub get

      - name: ï¸ğŸ§ª Update golden tests
        working-directory: packages/world_flags
        run: flutter test --update-goldens

      - name: ğŸš€ Commit updated golden files
        uses: stefanzweifel/git-auto-commit-action@v7.1.0
        with:
          branch: ${{ inputs.branch || github.ref_name }}
          file_pattern: "packages/world_flags/test/goldens/*"
          commit_message: "chore(test): update golden test files for `world_flags` package"
