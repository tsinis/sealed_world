name: deploy

on:
  push:
    branches: [main]
    paths:
      - "packages/world_countries/**"
      - ".github/workflows/world_countries.yaml"
      - ".github/workflows/deploy_example_web.yaml"

jobs:
  deploy:
    name: ğŸš€ Deploy example website
    runs-on: ubuntu-latest
    timeout-minutes: 24
    steps:
      - name: ğŸ“š Git checkout
        uses: actions/checkout@v4.2.2

      - name: ğŸ¦ Setup Flutter
        uses: subosito/flutter-action@v2.16.0
        with:
          cache: true
          channel: "master"
          cache-key: "flutter-:os:-:channel:-:version:-:arch:-:hash:"

      - name: ğŸ“¦ Install dependencies
        working-directory: packages/world_countries/example
        run: flutter pub get

      - name: ğŸ› ï¸ Build for web
        working-directory: packages/world_countries/example
        run: flutter build web --release --base-href=/sealed_world/ --wasm

      - name: ğŸ›« Deploy the website to GH Pages
        uses: s0/git-publish-subdir-action@v2.6.0
        env:
          REPO: self
          BRANCH: gh-pages
          FOLDER: packages/world_countries/example/build/web
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
